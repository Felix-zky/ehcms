<header>
	<div class="pull-left">
		<button class="btn btn-primary" id="open-uploader">上传新文件</button>
	</div>
	<div class="pull-right">
		{notempty name="iframe"}<button class="btn btn-danger" id="close-iframe">关闭资源空间</button>{/notempty}
	</div>
</header>
<section class="iframe-main">
	<div class="resource-list">
		<div class="pull-left resource-group">
			<ul>
				<li class="active">全部资源({$count})</li>
				<li data-id = "0"><span class="name">未分组</span>({$notGroupedCount})</li>
				{foreach $group as $v}
					<li data-id = "{$v.id}"><i class="fa {notempty name="v.children"}fa-plus-square{else /}fa-minus-square{/notempty}"></i><span class="name">{$v.name}</span>({$v.count})</li>
				{/foreach}
			</ul>
			<div id="add-group"><button class="btn btn-success btn-xs">新增资源目录</button></div>
		</div>
		<div class="pull-right resource-box">
			
		</div>
	</div>
</section>
<script type="text/html" id="create-parent">
	<li data-id="{{d.id}}"><i class="fa fa-minus-square"></i>{{d.name}}(0)</li>
</script>
<script type="text/html" id="create-children">
	<li data-id="{{d.id}}">{{d.name}}(0)</li>
</script>
<script type="text/javascript">
	require(['jquery', 'layer', 'eh.xhr'], function(){
		$(function(){
			var uploaderIndex;

			$('.resource-box').width($(window).outerWidth() - $('.resource-group').outerWidth(true));

			$('#open-uploader').click(function() {
				uploaderIndex = layer.open({
					type:2,
					title: false,
					resize: false,
					move: false,
					area: ['80%', '80%'],
					content: '/admin/resource/uploader.html'
				});
			});

			$('#add-group').click(function(){
				layer.prompt({title: '请输入新目录名称'}, function(value, index){
					layer.close(index);
					eh.xhr.createCommon('/admin/resource/addGroup', {name: value}, {name: value}, '.resource-group ul', 'create-parent');
				});
			});

			$('#close-iframe').click(function() {
				parent.layer.close(parent.layer.getFrameIndex(window.name));
			});
		});
	});
</script>